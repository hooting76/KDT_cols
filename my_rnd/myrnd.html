<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>초성 검색 + 카테고리 필터 + 성능 비교</title>
  <style>
    html {margin: 0 auto; max-width: 600px; text-align: center; height: 100%; border-right: 1px solid #ccc; border-left: 1px solid #ccc;}
    body { font-family: sans-serif; padding: 2em; }
    input, select { padding: 0.5em; margin-right: 1em; }
    ul { list-style: none; padding: 0; }
    li { margin: 0.3em 0; }
    span { color: gray; font-size: 0.9em; }
    canvas { margin: 5px auto; }
    #resultList { width:100%; height: 200px; overflow: auto; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; padding: 10px 0;}
    #resultList > li{ display:inline-block; width: fit-content; margin: 3px 5px; border: 1px solid #ccc; border-radius: 15px; padding: 1px 3px;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>🔍 초성 검색 + 🍱 카테고리 필터</h2>

  <!-- 검색어 입력창 -->
  <input type="text" id="searchInput" placeholder="이름 또는 초성을 입력하세요" />

  <!-- 카테고리 선택 필터 -->
  <select id="categoryFilter">
    <option value="all">전체 카테고리</option>
  </select>

  <!-- 검색 결과 출력 영역 -->
  <ul id="resultList"></ul>

  <script>
    let names = [];               // 전체 데이터 리스트 저장
    const indexMap = new Map();   // 초성 인덱스 Map 객체

    // 초성 추출 함수
    function getChosung(text) {
      const CHO = ['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
      let result = '';
      for (let char of text) {
        const code = char.charCodeAt(0) - 44032; // 한글 유니코드 시작값 기준
        if (code >= 0 && code <= 11171) {
          const cho = Math.floor(code / 588);
          result += CHO[cho]; // 초성만 추출
        } else {
          result += char; // 한글 외 문자는 그대로
        }
      }
      return result;
    }

    // 데이터 기반으로 초성 인덱스(Map)를 생성하는 함수
    function indexData() {
      indexMap.clear(); // 기존 Map 초기화
      names.forEach(item => {
        const cho = getChosung(item.name); // 이름에서 초성 추출
        indexMap.set(cho, (indexMap.get(cho) || []).concat(item)); // Map에 저장
      });
    }

    // 검색어 입력과 카테고리 선택 시 실행되는 검색 함수
    function searchNames(query) {
      const list = document.getElementById("resultList");
      const category = document.getElementById("categoryFilter").value;
      list.innerHTML = ''; // 결과 영역 초기화

      if (!query) return; // 검색어가 없으면 출력 안함

      const isChosung = /^[ㄱ-ㅎ]+$/.test(query); // 초성만으로 구성되었는지 검사

      const results = []; // 필터링된 결과 리스트
      names.forEach(item => {
        const matchTarget = isChosung ? getChosung(item.name) : item.name; // 검색 대상 선택
        const matched = matchTarget.includes(query); // 검색어 포함 여부 확인
        const categoryMatch = category === "all" || item.category === category; // 카테고리 일치 여부

        if (matched && categoryMatch) results.push(item); // 조건 만족 시 결과 추가
      });

      results.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `${item.name} <span>(${item.category})</span>`;
        list.appendChild(li); // 결과 리스트에 항목 추가
      });
    }

    // JSON 데이터에서 카테고리 옵션을 동적으로 생성하는 함수
    function updateCategoryOptions() {
      const select = document.getElementById("categoryFilter");
      const categories = new Set(names.map(n => n.category));
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option); // 필터 옵션에 카테고리 추가
      });
    }

    // 초기 실행: JSON 데이터 로드 및 이벤트 리스너 설정
    fetch('names.json')
      .then(res => res.json()) // JSON 데이터 파싱
      .then(data => {
        names = data;          // 전체 데이터 저장
        indexData();           // 초성 인덱스 생성
        updateCategoryOptions(); // 카테고리 옵션 업데이트

        // 검색어 입력 이벤트 연결
        document.getElementById("searchInput")
          .addEventListener("input", e => searchNames(e.target.value.trim()));

        // 카테고리 변경 이벤트 연결
        document.getElementById("categoryFilter")
          .addEventListener("change", () => {
            const query = document.getElementById("searchInput").value.trim();
            searchNames(query); // 검색어 그대로 다시 검색
          });
      });
  </script>
</body>
</html>
