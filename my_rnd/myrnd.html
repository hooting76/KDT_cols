<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>초성 검색 + 카테고리 필터</title>
  <style>
    html, body, div, span, applet, object, iframe,
    h1, h2, h3, h4, h5, h6, p, blockquote, pre,
    a, abbr, acronym, address, big, cite, code,
    del, dfn, em, img, ins, kbd, q, s, samp,
    small, strike, strong, sub, sup, tt, var,
    b, u, i, center,
    dl, dt, dd, ol, ul, li,
    fieldset, form, label, legend,
    table, caption, tbody, tfoot, thead, tr, th, td,
    article, aside, canvas, details, embed, 
    figure, figcaption, footer, header, hgroup, 
    menu, nav, output, ruby, section, summary,
    time, mark, audio, video {
      margin: 0;
      padding: 0;
      border: 0;
      font-size: 100%;
      font: inherit;
      vertical-align: baseline;
    }
    /* HTML5 display-role reset for older browsers */
    article, aside, details, figcaption, figure, 
    footer, header, hgroup, menu, nav, section {
      display: block;
    }
    body {
      line-height: 1;
    }
    ol, ul {
      list-style: none;
    }
    blockquote, q {
      quotes: none;
    }
    blockquote:before, blockquote:after,
    q:before, q:after {
      content: '';
      content: none;
    }
    table {
      border-collapse: collapse;
      border-spacing: 0;
    }
    /* css 초기화 끝 */

    /* ===================================================================     */

    /* 본문 css 시작 */
    /* 태그 css 시작 */
    h2{margin-bottom: 15px;}
    html {margin: 0 auto; max-width: 600px; text-align: center; height: 100%; border-right: 1px solid #ccc; border-left: 1px solid #ccc;}
    body { font-family: sans-serif; padding: 2em; }
    input, select { padding: 0.5em; margin-right: 1em; }
    ul { list-style: none; padding: 0; }
    span { color: gray; font-size: 0.9em; }
    canvas { margin: 5px auto; }
     /* 태그 css 끝 */

    /* id, class 지정 시작 */
    #searchInput::placeholder{color: #aaa; font-size: 12px;}
    #resultList { width:100%; height: 200px; overflow: auto; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; padding: 10px 0; margin: 15px 0;}
    #resultList > li:not(.el_isNull){ display:inline-block; width: fit-content; margin: 3px 5px; border: 1px solid #ccc; border-radius: 15px; padding: 5px; cursor: pointer; margin: 0.3em; }
    #resultList > li.el_isNull{ font-size: 18px; font-weight: bold; word-break: keep-all; margin: 75px 0;}

    .subTit{word-break: keep-all; line-height: 21px;}
    /* id, class 지정 끝 */
    /* 본문 css 끝 */
  
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>🔍 초성 검색 + 🍱 카테고리 필터</h2>
  <!-- 검색어 입력창 -->
  <input type="text" id="searchInput" placeholder="이름 또는 초성으로 입력해보세요." />

  <!-- 카테고리 선택 필터 -->
  <select id="categoryFilter">
    <option value="all">카테고리</option>
  </select>

  <!-- 검색 결과 출력 영역 -->
  <ul id="resultList">
    <li class="el_isNull">검색을 시도해 보세요.</li>
  </ul>

  <script>
    let names = [];               // 전체 데이터 리스트 저장
    const indexMap = new Map();   // 초성 인덱스 Map 객체

    // 초성 추출 함수
    function getChosung(text) {
      const CHO = ['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
      let result = '';
      for (let char of text) {
        const code = char.charCodeAt(0) - 44032; // 한글 유니코드 시작값 기준
        if (code >= 0 && code <= 11171) {
          const cho = Math.floor(code / 588);
          result += CHO[cho]; // 초성만 추출
        } else {
          result += char; // 한글 외 문자는 그대로
        }
      }
      return result;
    }

    // 데이터 기반으로 초성 인덱스(Map)를 생성하는 함수
    function indexData() {
      indexMap.clear(); // 기존 Map 초기화
      names.forEach(item => {
        const cho = getChosung(item.name); // 이름에서 초성 추출
        indexMap.set(cho, (indexMap.get(cho) || []).concat(item)); // Map에 저장
      });
    }

    // 검색어 입력과 카테고리 선택 시 실행되는 검색 함수
    function searchNames(query) {
      const list = document.getElementById("resultList");
      const category = document.getElementById("categoryFilter").value;
      list.innerHTML = ''; // 결과 영역 초기화

      //if (!query) return; // 검색어가 없으면 출력 안함

      const isChosung = /^[ㄱ-ㅎ]+$/.test(query); // 초성만으로 구성되었는지 검사

      const results = []; // 필터링된 결과 리스트
      let itemCnt = 0; // 결과 리스트 갯수 카운트
      names.forEach(item => {
        const matchTarget = isChosung ? getChosung(item.name) : item.name; // 검색 대상 선택
        const matched = matchTarget.includes(query); // 검색어 포함 여부 확인
        const categoryMatch = category === "all" || item.category === category; // 카테고리 일치 여부

        if (matched && categoryMatch){
          results.push(item); // 조건 만족 시 결과 추가
          itemCnt++;
        }else{itemCnt = itemCnt;}
      });
     
      // 검색요소가 있고 없고에 따라 예외 처리하기.
      if(itemCnt == 0){
        const el_isNull = document.createElement("li");
        el_isNull.className = "el_isNull";
        el_isNull.innerHTML = "해당 검색 내용이 존재하지 않습니다.";
        list.appendChild(el_isNull); // 결과 리스트에 항목 추가
      }else if(!query){
        const el_isNull = document.createElement("li");
        el_isNull.className = "el_isNull";
        el_isNull.innerHTML = "검색을 시도해 보세요.";
        list.appendChild(el_isNull); // 결과 리스트에 항목 추가        
      }else{
        results.forEach(item => {
          const li = document.createElement("li");
          li.innerHTML = `${item.name} <span>(${item.category})</span>`;
          list.appendChild(li); // 결과 리스트에 항목 추가
        });
      }
    }

    // JSON 데이터에서 카테고리 옵션을 동적으로 생성하는 함수
    function updateCategoryOptions() {
      const select = document.getElementById("categoryFilter");
      const categories = new Set(names.map(n => n.category));
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option); // 필터 옵션에 카테고리 추가
      });
    }

    // 초기 실행: JSON 데이터 로드 및 이벤트 리스너 설정
    fetch('names.json')
      .then(res => res.json()) // JSON 데이터 파싱
      .then(data => {
        names = data;          // 전체 데이터 저장
        indexData();           // 초성 인덱스 생성
        updateCategoryOptions(); // 카테고리 옵션 업데이트

        // 검색어 입력 이벤트 연결
        document.getElementById("searchInput")
          .addEventListener("input", e => searchNames(e.target.value.trim()));

        // 카테고리 변경 이벤트 연결
        document.getElementById("categoryFilter")
          .addEventListener("change", () => {
            const query = document.getElementById("searchInput").value.trim();
            searchNames(query); // 검색어 그대로 다시 검색
          });
      });
  </script>
  <p class="subTit">fetch()함수로 JSON 파일을 비동기 호출하여 초성검색 결과 출력에 대해 실시간으로 처리</p>
</body>
</html>
