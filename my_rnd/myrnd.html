<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì´ˆì„± ê²€ìƒ‰ + ì¹´í…Œê³ ë¦¬ í•„í„°</title>
  <style>
    html, body, div, span, applet, object, iframe,
    h1, h2, h3, h4, h5, h6, p, blockquote, pre,
    a, abbr, acronym, address, big, cite, code,
    del, dfn, em, img, ins, kbd, q, s, samp,
    small, strike, strong, sub, sup, tt, var,
    b, u, i, center,
    dl, dt, dd, ol, ul, li,
    fieldset, form, label, legend,
    table, caption, tbody, tfoot, thead, tr, th, td,
    article, aside, canvas, details, embed, 
    figure, figcaption, footer, header, hgroup, 
    menu, nav, output, ruby, section, summary,
    time, mark, audio, video {
      margin: 0;
      padding: 0;
      border: 0;
      font-size: 100%;
      font: inherit;
      vertical-align: baseline;
    }
    /* HTML5 display-role reset for older browsers */
    article, aside, details, figcaption, figure, 
    footer, header, hgroup, menu, nav, section {
      display: block;
    }
    body {
      line-height: 1;
    }
    ol, ul {
      list-style: none;
    }
    blockquote, q {
      quotes: none;
    }
    blockquote:before, blockquote:after,
    q:before, q:after {
      content: '';
      content: none;
    }
    table {
      border-collapse: collapse;
      border-spacing: 0;
    }
    /* css ì´ˆê¸°í™” ë */

    /* ===================================================================     */

    /* ë³¸ë¬¸ css ì‹œì‘ */
    /* íƒœê·¸ css ì‹œì‘ */
    h2{margin-bottom: 15px;}
    html {margin: 0 auto; max-width: 600px; text-align: center; height: 100%; border-right: 1px solid #ccc; border-left: 1px solid #ccc;}
    body { font-family: sans-serif; padding: 2em; }
    input, select { padding: 0.5em; margin-right: 1em; }
    ul { list-style: none; padding: 0; }
    span { color: gray; font-size: 0.9em; }
    canvas { margin: 5px auto; }
     /* íƒœê·¸ css ë */

    /* id, class ì§€ì • ì‹œì‘ */
    #searchInput::placeholder{color: #aaa; font-size: 12px;}
    #resultList { width:100%; height: 200px; overflow: auto; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; padding: 10px 0; margin: 15px 0;}
    #resultList > li:not(.el_isNull){ display:inline-block; width: fit-content; margin: 3px 5px; border: 1px solid #ccc; border-radius: 15px; padding: 5px; cursor: pointer; margin: 0.3em; }
    #resultList > li.el_isNull{ font-size: 18px; font-weight: bold; word-break: keep-all; margin: 75px 0;}

    .subTit{word-break: keep-all; line-height: 21px;}
    /* id, class ì§€ì • ë */
    /* ë³¸ë¬¸ css ë */
  
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>ğŸ” ì´ˆì„± ê²€ìƒ‰ + ğŸ± ì¹´í…Œê³ ë¦¬ í•„í„°</h2>
  <!-- ê²€ìƒ‰ì–´ ì…ë ¥ì°½ -->
  <input type="text" id="searchInput" placeholder="ì´ë¦„ ë˜ëŠ” ì´ˆì„±ìœ¼ë¡œ ì…ë ¥í•´ë³´ì„¸ìš”." />

  <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ í•„í„° -->
  <select id="categoryFilter">
    <option value="all">ì¹´í…Œê³ ë¦¬</option>
  </select>

  <!-- ê²€ìƒ‰ ê²°ê³¼ ì¶œë ¥ ì˜ì—­ -->
  <ul id="resultList">
    <li class="el_isNull">ê²€ìƒ‰ì„ ì‹œë„í•´ ë³´ì„¸ìš”.</li>
  </ul>

  <script>
    let names = [];               // ì „ì²´ ë°ì´í„° ë¦¬ìŠ¤íŠ¸ ì €ì¥
    const indexMap = new Map();   // ì´ˆì„± ì¸ë±ìŠ¤ Map ê°ì²´

    // ì´ˆì„± ì¶”ì¶œ í•¨ìˆ˜
    function getChosung(text) {
      const CHO = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'];
      let result = '';
      for (let char of text) {
        const code = char.charCodeAt(0) - 44032; // í•œê¸€ ìœ ë‹ˆì½”ë“œ ì‹œì‘ê°’ ê¸°ì¤€
        if (code >= 0 && code <= 11171) {
          const cho = Math.floor(code / 588);
          result += CHO[cho]; // ì´ˆì„±ë§Œ ì¶”ì¶œ
        } else {
          result += char; // í•œê¸€ ì™¸ ë¬¸ìëŠ” ê·¸ëŒ€ë¡œ
        }
      }
      return result;
    }

    // ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì´ˆì„± ì¸ë±ìŠ¤(Map)ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    function indexData() {
      indexMap.clear(); // ê¸°ì¡´ Map ì´ˆê¸°í™”
      names.forEach(item => {
        const cho = getChosung(item.name); // ì´ë¦„ì—ì„œ ì´ˆì„± ì¶”ì¶œ
        indexMap.set(cho, (indexMap.get(cho) || []).concat(item)); // Mapì— ì €ì¥
      });
    }

    // ê²€ìƒ‰ì–´ ì…ë ¥ê³¼ ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ ì‹¤í–‰ë˜ëŠ” ê²€ìƒ‰ í•¨ìˆ˜
    function searchNames(query) {
      const list = document.getElementById("resultList");
      const category = document.getElementById("categoryFilter").value;
      list.innerHTML = ''; // ê²°ê³¼ ì˜ì—­ ì´ˆê¸°í™”

      //if (!query) return; // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì¶œë ¥ ì•ˆí•¨

      const isChosung = /^[ã„±-ã…]+$/.test(query); // ì´ˆì„±ë§Œìœ¼ë¡œ êµ¬ì„±ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬

      const results = []; // í•„í„°ë§ëœ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸
      let itemCnt = 0; // ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ê°¯ìˆ˜ ì¹´ìš´íŠ¸
      names.forEach(item => {
        const matchTarget = isChosung ? getChosung(item.name) : item.name; // ê²€ìƒ‰ ëŒ€ìƒ ì„ íƒ
        const matched = matchTarget.includes(query); // ê²€ìƒ‰ì–´ í¬í•¨ ì—¬ë¶€ í™•ì¸
        const categoryMatch = category === "all" || item.category === category; // ì¹´í…Œê³ ë¦¬ ì¼ì¹˜ ì—¬ë¶€

        if (matched && categoryMatch){
          results.push(item); // ì¡°ê±´ ë§Œì¡± ì‹œ ê²°ê³¼ ì¶”ê°€
          itemCnt++;
        }else{itemCnt = itemCnt;}
      });
     
      // ê²€ìƒ‰ìš”ì†Œê°€ ìˆê³  ì—†ê³ ì— ë”°ë¼ ì˜ˆì™¸ ì²˜ë¦¬í•˜ê¸°.
      if(itemCnt == 0){
        const el_isNull = document.createElement("li");
        el_isNull.className = "el_isNull";
        el_isNull.innerHTML = "í•´ë‹¹ ê²€ìƒ‰ ë‚´ìš©ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        list.appendChild(el_isNull); // ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì— í•­ëª© ì¶”ê°€
      }else if(!query){
        const el_isNull = document.createElement("li");
        el_isNull.className = "el_isNull";
        el_isNull.innerHTML = "ê²€ìƒ‰ì„ ì‹œë„í•´ ë³´ì„¸ìš”.";
        list.appendChild(el_isNull); // ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì— í•­ëª© ì¶”ê°€        
      }else{
        results.forEach(item => {
          const li = document.createElement("li");
          li.innerHTML = `${item.name} <span>(${item.category})</span>`;
          list.appendChild(li); // ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì— í•­ëª© ì¶”ê°€
        });
      }
    }

    // JSON ë°ì´í„°ì—ì„œ ì¹´í…Œê³ ë¦¬ ì˜µì…˜ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    function updateCategoryOptions() {
      const select = document.getElementById("categoryFilter");
      const categories = new Set(names.map(n => n.category));
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option); // í•„í„° ì˜µì…˜ì— ì¹´í…Œê³ ë¦¬ ì¶”ê°€
      });
    }

    // ì´ˆê¸° ì‹¤í–‰: JSON ë°ì´í„° ë¡œë“œ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    fetch('names.json')
      .then(res => res.json()) // JSON ë°ì´í„° íŒŒì‹±
      .then(data => {
        names = data;          // ì „ì²´ ë°ì´í„° ì €ì¥
        indexData();           // ì´ˆì„± ì¸ë±ìŠ¤ ìƒì„±
        updateCategoryOptions(); // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì—…ë°ì´íŠ¸

        // ê²€ìƒ‰ì–´ ì…ë ¥ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById("searchInput")
          .addEventListener("input", e => searchNames(e.target.value.trim()));

        // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì´ë²¤íŠ¸ ì—°ê²°
        document.getElementById("categoryFilter")
          .addEventListener("change", () => {
            const query = document.getElementById("searchInput").value.trim();
            searchNames(query); // ê²€ìƒ‰ì–´ ê·¸ëŒ€ë¡œ ë‹¤ì‹œ ê²€ìƒ‰
          });
      });
  </script>
  <p class="subTit">fetch()í•¨ìˆ˜ë¡œ JSON íŒŒì¼ì„ ë¹„ë™ê¸° í˜¸ì¶œí•˜ì—¬ ì´ˆì„±ê²€ìƒ‰ ê²°ê³¼ ì¶œë ¥ì— ëŒ€í•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì²˜ë¦¬</p>
</body>
</html>
